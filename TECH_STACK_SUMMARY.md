# ğŸ¯ Bad Offset Identifier Tool - Complete Tech Stack & Codebase Summary

## ğŸ“ **Project Structure Overview**

```
/Users/nj/Projects/BadOffsetIdentifier/
â”œâ”€â”€ run_bot.py                       # ğŸš€ MAIN ENTRY POINT
â”œâ”€â”€ simple_viewer.py                 # ğŸ§  CORE PROCESSING ENGINE
â”œâ”€â”€ collect_decisions.py             # ğŸ“Š MERGE DOWNLOADED DECISIONS
â”œâ”€â”€ save_decision.py                 # ğŸ’¾ MANUAL CSV SAVE SCRIPT
â”œâ”€â”€ offset_assessment.html           # ğŸ–¥ï¸ GENERATED GUI (auto-created)
â”œâ”€â”€ decisions.csv                    # ğŸ“Š DECISION TRACKING (auto-created)
â”œâ”€â”€ README.md                        # ğŸ“š USER DOCUMENTATION
â””â”€â”€ TECH_STACK_SUMMARY.md           # ğŸ“‹ THIS FILE
```

---

## ğŸ› ï¸ **Tech Stack Breakdown**

### **Core Technologies**
| Technology | Purpose | Why Chosen |
|------------|---------|------------|
| **Python 3.9+** | Main programming language | Cross-platform, rich ecosystem |
| **pympi-ling** | EAF annotation file parsing | Specialized for ELAN files |
| **FFmpeg** | Video frame extraction | Industry standard for video processing |
| **HTML5/CSS3/JS** | User interface | Universal browser compatibility |
| **CSV** | Data persistence | Simple, readable, Excel-compatible |
| **Base64 encoding** | Frame embedding | Self-contained HTML files |

### **Python Libraries**
- `pympi` - ELAN annotation file processing
- `subprocess` - FFmpeg command execution
- `csv` - Decision tracking and persistence
- `base64` - Image encoding for HTML embedding
- `tempfile` - Temporary frame storage
- `pathlib` - Modern file path handling

---

## ğŸ“„ **File-by-File Breakdown**

### **ğŸš€ `run_bot.py` - Main Entry Point**
```python
# What it does:
- Checks if 2TB drive is connected
- Imports and runs the simple viewer assessment system
- Provides user-friendly error messages and instructions

# How it works:
1. Validates system requirements (2TB drive, dependencies)
2. Creates SimpleSignAnnotate instance
3. Calls generate_html() method
4. Provides user feedback and next steps

# When to use:
- Primary command to start the system
- python3 run_bot.py
```

### **ğŸ§  `simple_viewer.py` - Core Engine (Main Logic)**
```python
# What it does:
- Scans EAF files for annotation requirements (â‰¥20 total, â‰¥5 GOOD)
- Extracts video frames using FFmpeg
- Generates self-contained HTML assessment interface
- Handles automatic downloads and page refresh

# Key Methods:
class SimpleSignAnnotate:
    - find_conversation_files()     # Scans and filters EAF files
    - extract_annotation_frames()   # FFmpeg frame extraction at midpoint (47.5%)
    - generate_html_content()       # Creates HTML with scrollable interface
    - get_processed_files()         # Skip already processed files

# Technical Details:
- Midpoint sampling: 47.5% of gesture duration (optimal sign moment)
- Dominant hand detection: _LH.eaf = left, others = right
- Base64 frame embedding: Self-contained HTML files
- Dual video support: Shows Video 1 vs Video 2 side-by-side
```

### **ğŸ“Š `collect_decisions.py` - Decision Merger**
```python
# What it does:
- Scans Downloads folder for individual decision files
- Merges all decisions into master CSV file
- Handles duplicate detection and cleanup

# How it works:
1. Finds all decision_*.csv files in Downloads folder
2. Reads each file and extracts decision data
3. Merges into master decisions.csv file
4. Reports statistics and cleanup

# When to use:
- After completing assessment sessions
- Run: python3 collect_decisions.py
- Supervisor workflow for final data collection
```

### **ğŸ–¥ï¸ `offset_assessment.html` - Generated GUI**
```html
<!-- Auto-generated by standalone_assessment.py -->

Structure:
- Header with progress info
- Toggle buttons (Gallery/Grid view)
- Frame gallery with 45%/25% layout
- Assessment buttons (Accept/Reject)
- JavaScript for interactions and view switching

Features:
- Responsive CSS Grid and Flexbox layout
- Embedded video frames as Base64 images
- Keyboard shortcuts (Alt+A, Alt+R)
- View toggle between gallery and grid modes
- Decision recording with visual feedback
```

### **ğŸ“Š `decisions.csv` - Decision Tracking**
```csv
# Auto-generated CSV structure:
filename,decision,timestamp,notes
BF01F28WDC.eaf,accept,2024-09-26T11:30:15,Good alignment
BF02M25WDC.eaf,reject,2024-09-26T11:35:22,Poor timing

# How it's used:
- Created automatically on first run
- Updated immediately on each decision
- Read on startup to determine processed files
- Standard CSV format (Excel/Google Sheets compatible)
```

---

## ğŸ”§ **How Components Work Together**

### **Execution Flow:**
```
1. USER: python3 run_bot.py
   â†“
2. SYSTEM: Check requirements (2TB drive, dependencies)
   â†“
3. CORE ENGINE: Scan EAF files (â‰¥20 annotations, â‰¥5 GOOD)
   â†“
4. FRAME EXTRACTION: FFmpeg extracts midpoint frame per GOOD annotation
   â†“
5. HTML GENERATION: Create self-contained interface with embedded frames
   â†“
6. BROWSER: Auto-opens HTML file showing scrollable interface
   â†“
7. USER: Review dual video frames, click Accept/Reject
   â†“
8. DOWNLOAD: Decision file auto-downloads to Downloads folder
   â†“
9. AUTO-REFRESH: Page automatically refreshes for next file
   â†“
10. SUPERVISOR: Run python3 collect_decisions.py to merge all decisions
```

### **Data Flow:**
```
EAF Files (2TB Drive) â†’ Python Parser â†’ Frame Extraction â†’ HTML Generation
                                   â†“
CSV Tracking â† User Decision â† Browser Interface â† Base64 Frames
```

---

## ğŸ¯ **Core Algorithms**

### **File Selection Algorithm:**
```python
for each .eaf file in conversation folder:
    if file_size > 100KB:
        determine_dominant_hand(filename)  # _LH = left, else right
        count_total_annotations(dominant_tier)
        if total_annotations >= 20:
            count_good_annotations(dominant_tier)
            if good_annotations >= 5:
                add_to_processing_queue(file)
```

### **Frame Extraction Algorithm:**
```python
for each GOOD annotation:
    duration = end_time - start_time
    extract_frames_at:
        - 30% (early): start + duration * 0.30  # Gesture formation
        - 45% (peak1): start + duration * 0.45  # Primary peak
        - 65% (peak2): start + duration * 0.65  # Sustained peak
        - 80% (late):  start + duration * 0.80  # Completion
    encode_as_base64(frames)
```

### **Resume Algorithm:**
```python
processed_files = read_csv_decisions()
all_files = scan_eaf_directory()
unprocessed_files = [f for f in all_files if f not in processed_files]
process_next_file(unprocessed_files[0])
```

---

## ğŸŒ **Frontend Architecture (Generated HTML)**

### **CSS Layout Strategy:**
```css
/* Gallery View (Default) */
.frame-gallery { display: flex; flex-wrap: wrap; }
.main-frame { width: 45%; }          /* Primary gesture frame */
.secondary-frames { width: 25%; }    /* Supporting context frames */

/* Grid View (Toggle) */
.frame-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
}
```

### **JavaScript Functionality:**
```javascript
// View switching between gallery and grid
function switchView(viewType) {
    toggle_display(galleryContainer, gridContainer);
}

// Decision recording (with optional server integration)
function recordDecision(decision) {
    save_to_csv(decision);  // Local or via HTTP server
    show_feedback(decision);
    prepare_next_file();
}

// Keyboard shortcuts for efficiency
Alt + A = Accept
Alt + R = Reject
```

---

## ğŸ”„ **Integration Points**

### **External Dependencies:**
- **FFmpeg**: Must be installed and in PATH for video processing
- **2TB Drive**: Must be mounted at `/Volumes/2TB HD/`
- **Browser**: Any modern browser for HTML interface
- **Python Libraries**: pympi-ling for EAF file parsing

### **File System Integration:**
- **Input**: EAF files from 2TB drive conversation folder
- **Processing**: Temporary frame extraction directory
- **Output**: HTML file and CSV decisions in project folder
- **State**: CSV file provides persistent state between sessions

### **Cross-Platform Compatibility:**
- **macOS**: Primary development platform (current setup)
- **Windows**: Compatible (adjust drive paths)
- **Linux**: Compatible (adjust drive paths)

---

## ğŸ¯ **For Your Supervisor - Technical Overview**

**Architecture**: Standalone Python application generating self-contained HTML interfaces
**Performance**: Targets 50 files/hour (72 seconds per file) assessment rate
**Reliability**: CSV-based state persistence with atomic writes
**Scalability**: Handles hundreds of annotation files with resume capability
**Usability**: Browser-based GUI with keyboard shortcuts and responsive design

**The system demonstrates:**
- âœ… **Computer Vision**: Multi-point temporal sampling of sign language gestures
- âœ… **Data Processing**: EAF file parsing and annotation filtering
- âœ… **Web Technologies**: Responsive HTML/CSS/JavaScript interface generation
- âœ… **User Experience**: 45%/25% gallery layout reducing cognitive load
- âœ… **Software Engineering**: Modular design with clear separation of concerns

---

## ğŸ“‹ **Quick Reference Commands**

```bash
# Start the system
python3 run_bot.py

# Merge downloaded decisions (supervisor task)
python3 collect_decisions.py

# Check file structure
ls -la /Users/nj/Projects/BadOffsetIdentifier/

# View current decisions
open decisions.csv
```

**This is your complete, production-ready bad offset identification system!** ğŸš€